import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';

const EXAMS_DIR = path.join(process.cwd(), 'src/content/exams');
const OUTPUT_FILE = path.join(process.cwd(), 'src/data/generated-exams.ts');

async function generateExams() {
    if (!fs.existsSync(EXAMS_DIR)) {
        console.log('No exams directory found.');
        return;
    }

    const files = fs.readdirSync(EXAMS_DIR);
    const exams = {};

    for (const file of files) {
        if (!file.endsWith('.md')) continue;

        const content = fs.readFileSync(path.join(EXAMS_DIR, file), 'utf-8');
        const { data, content: markdown } = matter(content);

        if (!data.id) {
            console.warn(`Skipping ${file}: Missing id in frontmatter`);
            continue;
        }

        exams[data.id] = {
            id: data.id,
            title: data.title || 'Untitled Exam',
            category: data.category || 'CKA',
            duration: data.duration || '120 mins',
            markdown: markdown
        };
    }

    const fileContent = `// Auto-generated by scripts/generate-exams.mjs
import { Lesson } from './lessons';

export const generatedExams: Record<string, Lesson> = ${JSON.stringify(exams, null, 2)};
`;

    fs.writeFileSync(OUTPUT_FILE, fileContent);
    console.log(`Generated ${Object.keys(exams).length} exams to ${OUTPUT_FILE}`);
}

generateExams();
