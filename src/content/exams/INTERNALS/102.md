---
id: 102
title: Etcd & Raft Consensus
category: INTERNALS
duration: 60 mins
---

# Etcd & The Raft Consensus Algorithm

How does Kubernetes maintain a consistent state across multiple control plane nodes? It relies entirely on **Etcd**.

## What is Etcd?
Etcd is a distributed, reliable key-value store. It is the "source of truth" for Kubernetes.

## The Raft Algorithm
Etcd uses **Raft** to achieve consensus.
1.  **Leader Election**: One node is elected leader. All writes go to the leader.
2.  **Log Replication**: The leader replicates the entry to followers.
3.  **Commit**: Once a majority (Quorum) acknowledges the entry, it is committed.

### Quorum
$N/2 + 1$. For a 3-node cluster, you need 2 nodes to agree.
-   **3 Nodes**: Tolerate 1 failure.
-   **5 Nodes**: Tolerate 2 failures.

# Task 1: Check Etcd Health
Verify that the etcd endpoint is healthy.

```bash
ETCDCTL_API=3 etcdctl \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key \
  endpoint health
```

```setup
# Check if certs exist (only on controlplane)
ls /etc/kubernetes/pki/etcd/server.crt > /dev/null 2>&1 || echo "Warning: Run this on controlplane node"
```

```verify
ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key endpoint health | grep healthy
```
