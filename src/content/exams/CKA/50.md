---
id: 50
title: Cluster Maintenance
category: CKA
duration: 45 mins
---

# Cluster Maintenance

Keeping the lights on.

## Cluster Upgrade
Using \`kubeadm\` to upgrade the cluster.
1.  Upgrade Control Plane node.
2.  Upgrade Worker nodes.

\`\`\`bash
# Drain the node first
kubectl drain node-1 --ignore-daemonsets

# Upgrade kubeadm
apt-get update && apt-get install -y kubeadm=1.27.0-00

# Plan the upgrade
kubeadm upgrade plan

# Apply
kubeadm upgrade apply v1.27.0
\`\`\`

## Backup & Restore
**Etcd** is the source of truth. You MUST know how to snapshot it.

\`\`\`bash
# Take a snapshot
ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 \\
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\
  --cert=/etc/kubernetes/pki/etcd/server.crt \\
  --key=/etc/kubernetes/pki/etcd/server.key \\
  snapshot save /tmp/etcd-backup.db
\`\`\`
